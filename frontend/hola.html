<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ea.mxshop</title>
<style>
  *{box-sizing:border-box;}
  body{background:#000;color:#fff;font-family:'Poppins',sans-serif;margin:0;padding:0;}
  h1,h2,h3{text-align:center;letter-spacing:1px;}
  a{color:#fff;text-decoration:none;}
  button{cursor:pointer;}
  header{background:#111;display:flex;justify-content:space-between;align-items:center;padding:15px 40px;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(255,255,255,0.1);}
  .logo{font-size:1.5em;font-weight:bold;letter-spacing:2px;}
  nav a{margin:0 15px;font-size:1em;transition:color 0.3s;}
  nav a:hover{color:rgb(68,83,83);}
  .carrito-icono{font-size:1.5em;position:relative;}
  .contador{position:absolute;top:-8px;right:-10px;background:red;color:white;border-radius:50%;padding:2px 7px;font-size:0.8em;}
  .contenedor{display:flex;flex-wrap:wrap;justify-content:center;gap:40px;padding:60px 20px;}
  .producto{width:300px;background:#111;border-radius:20px;overflow:hidden;box-shadow:0 0 20px rgba(255,255,255,0.1);transition:transform 0.3s ease,box-shadow 0.3s ease;text-align:center;position:relative;}
  .producto:hover{transform:scale(1.05);box-shadow:0 0 30px rgba(255,255,255,0.2);}
  .carousel{position:relative;width:100%;height:300px;overflow:hidden;}
  .carousel img{width:100%;height:300px;object-fit:cover;position:absolute;top:0;left:0;opacity:0;transition:opacity 1s ease;}
  .carousel img.active{opacity:1;}
  .boton{position:absolute;top:50%;transform:translateY(-50%);background-color:rgba(255,255,255,0.1);border:none;color:white;font-size:24px;cursor:pointer;padding:10px;border-radius:50%;transition:background-color 0.3s;z-index:10;}
  .boton:hover{background-color:rgba(255,255,255,0.4);}
  .prev{left:10px;}
  .next{right:10px;}
  .modelo{margin:15px 0;font-size:1.2em;font-weight:600;text-transform:uppercase;}
  .precio{font-size:1em;color:rgba(255,255,255,0.4);margin-bottom:10px;}
  .stock{font-size:0.9em;color:lightgreen;margin-bottom:10px;}
  .sin-stock{color:red;font-weight:bold;}
  .agregar{background-color:rgba(255,255,255,0.4);border:none;color:#000;font-weight:bold;padding:10px 20px;margin-bottom:20px;border-radius:8px;transition:0.3s;}
  .agregar:hover{background-color:rgba(255,255,255,0.6);}
  .carrito{position:fixed;top:80px;right:20px;background:#111;padding:20px;border-radius:15px;width:280px;box-shadow:0 0 20px rgba(255,255,255,0.2);display:none;}
  .carrito h3{margin-top:0;}
  .carrito-item{display:flex;justify-content:space-between;margin:10px 0;}
  .carrito-total{border-top:1px solid #333;margin-top:10px;padding-top:10px;font-weight:bold;}
  .btn-pagar{margin-top:10px;background-color:#fff;color:#000;padding:10px 15px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
  .btn-pagar:hover{background-color:#444;color:#fff;}
  .contacto{background:#111;padding:60px 20px;text-align:center;}
  .contacto form{max-width:400px;margin:0 auto;display:flex;flex-direction:column;gap:15px;}
  input,textarea{padding:10px;border-radius:8px;border:none;background:#222;color:#fff;}
  button.enviar{background:rgba(255,255,255,0.4);border:none;color:#000;font-weight:bold;padding:12px;border-radius:8px;transition:0.3s;}
  button.enviar:hover{background:rgba(255,255,255,0.6);}
  .pago{background:#000;color:#fff;padding:2rem;border-radius:12px;max-width:500px;margin:2rem auto;display:none;}
  .pago input,.pago textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:none;}
  .pago button{background:#fff;color:#000;border:none;padding:10px 15px;border-radius:8px;cursor:pointer;font-weight:bold;}
  .pago button:hover{background:#444;color:#fff;}
  footer{background-color:#000;padding:20px;font-size:0.9em;color:#777;border-top:1px solid #222;}
  @media(max-width:768px){.producto{width:90%;}}
</style>
</head>
<body>

<header>
  <div class="logo">ea.mxshop</div>
  <nav>
    <a href="#catalogo">CatÃ¡logo</a>
    <a href="#contacto">ContÃ¡ctanos</a>
  </nav>
  <div class="carrito-icono" onclick="toggleCarrito()">ðŸ›’ <span class="contador" id="contador">0</span></div>
</header>

<section id="catalogo">
  <h1>CatÃ¡logo de Productos</h1>
  <div class="contenedor" id="contenedorProductos"></div>
</section>

<div class="carrito" id="carrito">
  <h3>ðŸ›’ Tu carrito</h3>
  <div id="listaCarrito"></div>
  <p class="carrito-total">Total: $<span id="total">0</span></p>
  <button class="btn-pagar" onclick="mostrarFormularioPago()">Pagar carrito</button>
</div>

<section id="pago" class="pago">
  <h2>Finalizar pedido</h2>
  <form id="formPago">
    <input type="text" id="nombrePago" placeholder="Tu nombre completo" required>
    <input type="email" id="correoPago" placeholder="Tu correo" required>
    <input type="tel" id="telefonoPago" placeholder="Tu telÃ©fono" required>
    <textarea id="direccionPago" rows="3" placeholder="Tu direcciÃ³n completa" required></textarea>
    <p><strong>Total a pagar:</strong> $<span id="totalPago">0</span></p>
    <button type="submit" class="enviar">Confirmar pedido</button>
  </form>
  <div id="estadoPedido" style="margin-top:10px;"></div>
</section>

<section id="contacto" class="contacto">
  <h2>ContÃ¡ctanos</h2>
  <form id="formContacto">
    <input type="text" id="nombre" placeholder="Tu nombre" required>
    <input type="email" id="correo" placeholder="Tu correo" required>
    <textarea id="mensaje" rows="4" placeholder="Tu mensaje" required></textarea>
    <button type="submit" class="enviar">Enviar</button>
  </form>
  <div id="estadoMensaje" style="margin-top:10px;"></div>
</section>

<footer>Â© 2025 ea.mxshop â€” Todos los derechos reservados</footer>

<script>
let carrito = [];
let productos = [];

function crearProductos() {
  productos = [
    {id:1, nombre:'Modelo Alpha', precio:999, imagenes:['gorra1.jpg','gorra10.jpg','gorra1.jpg','gorra1.jpg']},
    {id:2, nombre:'Modelo Beta', precio:1299, imagenes:['gorra2.jpg','gorra2.jpg','gorra2.jpg','gorra2.jpg']},
    {id:3, nombre:'Modelo Gamma', precio:1499, imagenes:['gorra3.jpg','gorra3.jpg','gorra3.jpg','gorra3.jpg']},
    {id:4, nombre:'Modelo Delta', precio:1799, imagenes:['gorra4.jpg','gorra4.jpg','gorra4.jpg','gorra4.jpg']},
    {id:5, nombre:'Modelo Epsilon', precio:1999, imagenes:['gorra5.jpg','gorra5.jpg','gorra5.jpg','gorra5.jpg']},
    {id:6, nombre:'Modelo Zeta', precio:2099, imagenes:['gorra6.jpg','gorra6.jpg','gorra6.jpg','gorra6.jpg']},
    {id:7, nombre:'Modelo Eta', precio:2199, imagenes:['gorra7.jpg','gorra7.jpg','gorra7.jpg','gorra7.jpg']},
    {id:8, nombre:'Modelo Theta', precio:2299, imagenes:['gorra8.jpg','gorra8.jpg','gorra8.jpg','gorra8.jpg']},
    {id:9, nombre:'Modelo Iota', precio:2399, imagenes:['gorra9.jpg','gorra9.jpg','gorra9.jpg','gorra9.jpg']},
    {id:10, nombre:'Modelo Kappa', precio:2499, imagenes:['gorra10.jpg','gorra10.jpg','gorra10.jpg','gorra10.jpg']},
    {id:11, nombre:'Modelo Lambda', precio:2599, imagenes:['gorra11.jpg','gorra11.jpg','gorra11.jpg','gorra11.jpg']},
    {id:12, nombre:'Modelo Mu', precio:2699, imagenes:['gorra12.jpg','gorra12.jpg','gorra12.jpg','gorra12.jpg']},
  ];

  const contenedor = document.getElementById('contenedorProductos');
  contenedor.innerHTML = '';

  productos.forEach(p => {
    const div = document.createElement('div');
    div.className = 'producto';
    
    // Carrusel
    const carrusel = document.createElement('div');
    carrusel.className = 'carousel';
    p.imagenes.forEach((src, i) => {
      const img = document.createElement('img');
      img.src = src;
      if (i === 0) img.classList.add('active');
      carrusel.appendChild(img);
    });

    const prevBtn = document.createElement('button');
    prevBtn.className = 'boton prev';
    prevBtn.textContent = 'â€¹';
    const nextBtn = document.createElement('button');
    nextBtn.className = 'boton next';
    nextBtn.textContent = 'â€º';
    carrusel.appendChild(prevBtn);
    carrusel.appendChild(nextBtn);

    let index = 0;
    const imgs = carrusel.querySelectorAll('img');

    prevBtn.onclick = () => {
      imgs[index].classList.remove('active');
      index = (index - 1 + imgs.length) % imgs.length;
      imgs[index].classList.add('active');
    };
    nextBtn.onclick = () => {
      imgs[index].classList.remove('active');
      index = (index + 1) % imgs.length;
      imgs[index].classList.add('active');
    };

    setInterval(() => nextBtn.click(), 4000); // cambia cada 4s

    const nombre = document.createElement('p');
    nombre.className = 'modelo';
    nombre.textContent = p.nombre;

    const precio = document.createElement('p');
    precio.className = 'precio';
    precio.textContent = `$${p.precio} MXN`;

    const stock = document.createElement('p');
    stock.className = 'stock';
    stock.id = `stock-${p.id}`;
    stock.textContent = `Stock: ${p.stock}`;

    const btn = document.createElement('button');
    btn.className = 'agregar';
    btn.textContent = 'Agregar al carrito';
    btn.addEventListener('click', () => agregarCarrito(p.id));

    div.append(carrusel, nombre, precio, stock, btn);
    contenedor.appendChild(div);
  });
}

function agregarCarrito(id) {
  const p = productos.find(x => x.id === id);
  if (p.stock > 0) {
    carrito.push({nombre: p.nombre, precio: p.precio});
    p.stock--;
    document.getElementById(`stock-${id}`).textContent = `Stock: ${p.stock}`;
    actualizarCarritoUI();
    actualizarContador();
  } else {
    alert('âŒ Sin stock disponible');
  }
}

function toggleCarrito() {
  const c = document.getElementById('carrito');
  c.style.display = c.style.display === 'block' ? 'none' : 'block';
}

function actualizarCarritoUI() {
  const lista = document.getElementById('listaCarrito');
  lista.innerHTML = '';
  let total = 0;
  carrito.forEach((item, i) => {
    total += item.precio;
    const div = document.createElement('div');
    div.className = 'carrito-item';
    div.innerHTML = `${item.nombre} $${item.precio} <button onclick="eliminarDelCarrito(${i})" style="background:none;border:none;color:red;">âœ–</button>`;
    lista.appendChild(div);
  });
  document.getElementById('total').textContent = total;
  document.getElementById('totalPago').textContent = total;
}

function eliminarDelCarrito(i) {
  carrito.splice(i, 1);
  actualizarCarritoUI();
  actualizarContador();
}

function actualizarContador() {
  document.getElementById('contador').textContent = carrito.length;
}

function mostrarFormularioPago() {
  if (carrito.length === 0) {
    alert('Tu carrito estÃ¡ vacÃ­o');
    return;
  }
  document.getElementById('pago').style.display = 'block';
  window.scrollTo(0, document.getElementById('pago').offsetTop);
}

document.getElementById('formPago').addEventListener('submit', e => {
  e.preventDefault();
  const nombre = document.getElementById('nombrePago').value.trim();
  const correo = document.getElementById('correoPago').value.trim();
  const telefono = document.getElementById('telefonoPago').value.trim();
  const direccion = document.getElementById('direccionPago').value.trim();
  const total = document.getElementById('totalPago').textContent;
  const estado = document.getElementById('estadoPedido');
  const numeroOrden = 'EA' + Math.floor(100000 + Math.random() * 900000);

  fetch("http://localhost:4000/pedidos", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({nombre, correo, telefono, direccion, total, items: carrito, numeroOrden})
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok) {
      estado.innerHTML = `âœ… Pedido enviado correctamente<br><strong>NÃºmero de orden:</strong> ${numeroOrden}`;
      estado.style.color = "lightgreen";
      carrito = [];
      actualizarCarritoUI();
      actualizarContador();
      document.getElementById('formPago').reset();
    } else {
      estado.textContent = "âš ï¸ Error al enviar el pedido";
      estado.style.color = "orange";
    }
  })
  .catch(err => {
    console.error(err);
    estado.textContent = "âŒ No se pudo conectar con el servidor";
    estado.style.color = "red";
  });
});

document.getElementById('formContacto').addEventListener('submit', e => {
  e.preventDefault();
  const nombre = document.getElementById('nombre').value.trim();
  const correo = document.getElementById('correo').value.trim();
  const mensaje = document.getElementById('mensaje').value.trim();
  const estado = document.getElementById('estadoMensaje');
  fetch("http://localhost:4000/contacto", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({nombre, correo, mensaje})
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok) {
      estado.textContent = "âœ… Mensaje enviado";
      estado.style.color = "lightgreen";
      document.getElementById('formContacto').reset();
    } else {
      estado.textContent = "âš ï¸ Error al enviar el mensaje";
      estado.style.color = "orange";
    }
  })
  .catch(err => {
    console.error(err);
    estado.textContent = "âŒ No se pudo conectar con el servidor";
    estado.style.color = "red";
  });
});

document.addEventListener('DOMContentLoaded', () => {
  crearProductos();
  actualizarCarritoUI();
  actualizarContador();
});
</script>
</body>
</html>
